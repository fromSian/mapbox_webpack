/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import e from"../core/Error.js";import{isNone as t,isSome as o}from"../core/maybe.js";import{g as r,f as n,d as s,b as i,a}from"./vec3.js";import{c as l}from"./vec3f64.js";import{canProjectToWGS84ComparableLonLat as c}from"../geometry/projection.js";import{containsPoint as f,containsPointWithMargin as m,fromExtent as u,create as p}from"../geometry/support/aaBoundingRect.js";import{MAX_ROOT_TILES as h}from"../views/3d/terrain/TerrainConst.js";import g from"../views/3d/terrain/TilingScheme.js";const d=l(),M=l(),j=l(),v=l();function x(e,o,r=0){const n=e.extent;if(t(n))return!1;if(0===r)return f(n,o);const s=Math.min(n[2]-n[0],n[3]-n[1]);return m(n,o,r*s)}function S(e,t,o,l){r(d,o),d[l]=t[l];const c=n(d,d,t),f=n(M,e,t),m=s(f,c),u=s(c,c);let p;p=m<=0?t:u<=m?o:i(d,t,a(c,c,m/u));const h=n(d,e,p);return Math.PI/2-Math.atan(h[2]/Math.sqrt(h[0]*h[0]+h[1]*h[1]))}function w(e,o,r){const n=e.extent;if(t(n))return 0;j[0]=n[0],j[1]=n[1],j[2]=r,v[0]=n[2],v[1]=n[3],v[2]=r;let s=1/0,i=1/0;return o[0]<j[0]?s=S(o,j,v,0):o[0]>v[0]&&(s=S(o,v,j,0)),o[1]<j[1]?i=S(o,j,v,1):o[1]>v[1]&&(i=S(o,v,j,1)),Math.min(s,i)}function R(t,r,n){if(t.spatialReference.isGeographic&&!c(t.spatialReference))return new e("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const s=g.checkUnsupported(t);if(o(s))return s;const i=T(t,n);return i||(r&&!t.spatialReference.equals(r)?new e("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null)}function T(t,o){const r=t.lods,n=r[0].resolution*2**r[0].level,s=[n*t.size[0],n*t.size[1]],i=[t.origin.x,t.origin.y],a=u(o),l=p();g.computeRowColExtent(a,s,i,l);const c=(l[2]-l[0])*(l[3]-l[1]);if(c>h){const o=r[0].scale*2**r[0].level;let s=Math.max((a[3]-a[1])/t.size[1],(a[2]-a[0])/t.size[0])*o/n;const i=Math.floor(Math.log(s)/Math.log(10));return s=Math.ceil(s/10**i)*10**i,new e("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(o).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+s.toLocaleString()+".",{level0Scale:o,suggestedLevel0Scale:s,requiredNumRootTiles:c,allowedNumRootTiles:h})}return null}const y=Object.freeze({__proto__:null,isInsideExtent:x,tiltToExtentEdge:w,checkIfTileInfoSupportedForViewSR:R});export{w as a,R as c,x as i,y as t};
