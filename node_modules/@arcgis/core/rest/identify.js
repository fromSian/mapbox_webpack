/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import t from"../request.js";import{normalizeCentralMeridian as r}from"../geometry/support/normalizeUtils.js";import{parseUrl as e,encode as s,asValidOptions as o}from"./utils.js";import n from"./support/IdentifyParameters.js";import u from"./support/IdentifyResult.js";import{identifyToIdentifyRESTParameters as i}from"../tasks/operations/identify.js";async function f(n,u,f){const l=(u=p(u)).geometry?[u.geometry]:[],y=e(n);return y.path+="/identify",r(l).then((r=>{const e=i(u,{geometry:r&&r[0]}),n=s({...y.query,f:"json",...e}),p=o(n,f);return t(y.path,p).then(m).then((t=>a(t,u.sublayers)))}))}function m(t){const r=t.data;r.results=r.results||[];const e={results:[]};return e.results=r.results.map((t=>u.fromJSON(t))),e}function p(t){return t=n.from(t)}function a(t,r){if(null==r||!r.length)return t;for(const e of t.results){const t=r.find((t=>e.layerId===t.id));e.feature.sourceLayer=t}return t}export{f as identify};
