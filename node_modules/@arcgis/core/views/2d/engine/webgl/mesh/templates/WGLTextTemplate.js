/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{bidiText as t}from"../../../../../../core/BidiText.js";import{pt2px as e,toPt as i}from"../../../../../../core/screenUtils.js";import{getJustification as o,getXAnchorDirection as s,getYAnchorDirection as n}from"../../alignmentUtils.js";import{premultiplyAlphaRGBAArray as r,premultiplyAlphaRGBA as a}from"../../color.js";import{GLYPH_SIZE as l,MIN_MAX_ZOOM_PRECISION_FACTOR as m}from"../../definitions.js";import{i1616to32 as h}from"../../number.js";import{MaterialKeyBase as f}from"../../materialKey/MaterialKey.js";import{DEFAULT_MIN_ZOOM as c,DEFAULT_MAX_ZOOM as _,getMinMaxZoom as d}from"./util.js";import x from"./WGLBaseTextTemplate.js";import z from"./WGLMeshTemplate.js";const u=5;class M extends(x(z)){constructor(t,r,a,c,_,d,x,z,M,p,g,j,S,y,b,T,V,A,C=!1,I,K){super(),this._xOffset=e(S),this._yOffset=e(y),this._decoration=p||"none",this._color=_,this._haloColor=d,this._haloSize=Math.min(Math.floor(u*e(i(a))),127),this._size=Math.min(Math.round(e(r)),127);const v=Math.min(Math.round(e(c||r)),127);this._referenceSize=Math.round(Math.sqrt(256*v)),this._scale=this._size/l,this._angle=j,this._justify=o(x||"center"),this._xAlignD=s(x||"center"),this._yAlignD=n(z||"baseline"),this._baseline="baseline"===(z||"baseline"),this._bitset=(1===M?1:0)|(g?1:0)<<1;const B=f.load(t);B.sdf=!0,this._materialKey=B.data,this._lineWidth=e(b)||512,this._lineHeight=T||1,this._textPlacement=V,this._effects=A,this._isCIM=C,this._minMaxZoom=h(Math.round(I*m),Math.round(K*m))}static fromText(e,i){const o=new M(e.materialKey,e.font.size,e.haloSize||0,e.font.size,e.color&&r(e.color)||0,e.haloColor&&r(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,0,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1,c,_),[,s]=t(e.text);return o.bindTextInfo(i,s),o._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,o}static fromCIMText(e,i,o){const s=e.scaleFactor||1,n=e.size*e.sizeRatio*s,[r,l]=d(e.scaleInfo,o),m=new M(e.materialKey,n,e.outlineSize*e.sizeRatio,e.referenceSize,a(e.color),a(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*s,e.offsetY*e.sizeRatio*s,512,1,e.markerPlacement,e.effects,!0,r,l),[,h]=t(e.text);return m.bindTextInfo(i,h),m._vertexBoundsScale=e.maxVVSize?e.maxVVSize/n:1,m}}export{M as default};
