/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import e from"../../../../../../core/Logger.js";import{pt2px as t}from"../../../../../../core/screenUtils.js";import{premultiplyAlphaRGBAArray as i,premultiplyAlphaRGBA as r}from"../../color.js";import{MIN_MAX_ZOOM_PRECISION_FACTOR as s,SPRITE_PADDING as o,BITSET_TYPE_FILL_OUTLINE as l,BITSET_GENERIC_LOCK_COLOR as n,BITSET_LINE_SCALE_DASH as a}from"../../definitions.js";import{i1616to32 as m}from"../../number.js";import{getCapType as c,getJoinType as h}from"../../Utils.js";import{LineMaterialKey as f}from"../../materialKey/MaterialKey.js";import{getLimitCosine as u,getMinMaxZoom as d,DEFAULT_MIN_ZOOM as p,DEFAULT_MAX_ZOOM as L}from"./util.js";import y from"./WGLBaseLineTemplate.js";import S from"./WGLMeshTemplate.js";const _=e.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class j extends(y(S)){constructor(e,t,i,r,o,c,h,d,p,L,y,S,_,j,g,w,P,K,x){super();const T=f.load(e);t&&(T.sdf=t.sdf,T.pattern=!0,T.textureBinding=t.textureBinding),this._capType=r,this._joinType=o,this._miterLimitCosine=u(c),this.tessellationProperties._fillColor=h,this.tessellationProperties._tl=d,this.tessellationProperties._br=p,this._hasPattern=L,this._isDashed=y,this._zOrder=w,this._effects=P,this._minMaxZoom=m(Math.round(K*s),Math.round(x*s)),this._materialKey=T.data;const b=(_?n:0)|(j?l:0)|(S?a:0);this.tessellationProperties._bitset=b,this.tessellationProperties._halfWidth=.5*i,this.tessellationProperties._halfReferenceWidth=.5*g,this.tessellationProperties.offset=0,this._initializeTessellator(!1)}static fromCIMLine(e,i,s){const l=e.color,n=e.scaleFactor||1,a=!!e.dashTemplate;let c=e.cap;a&&1===c&&(c=2);const h=e.join,f=t(e.width)*n,u=t(e.referenceWidth),p=t(e.miterLimit),L=l&&r(l)||0,[y,S]=d(e.scaleInfo,s),_=!1;if(!i)return new j(e.materialKey,i,f,c,h,p,L,0,0,!1,a,e.scaleDash,e.colorLocked,_,u,e.zOrder,e.effects,y,S);const{rect:g,width:w,height:P}=i,K=g.x+o,x=g.y+o,T=K+w,b=x+P,M=m(K,x),W=m(T,b),O=!1;return new j(e.materialKey,i,f,c,h,p,L,M,W,!0,a,e.scaleDash,e.colorLocked,O,u,e.zOrder,e.effects,y,S)}static fromFillOutline(e){var t;return e.isOutlinedFill&&e.outline&&"esriSLSSolid"===(null==(t=e.outline)?void 0:t.style)?j.fromSimpleLine({hash:"",materialKey:e.materialKey,...e.outline},null,!0):null}static fromSimpleLine(e,r,s=!1){const{color:l}=e,n="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,a=c(e.cap||"round"),f=h(e.join||"round");let u=l&&"esriSLSNull"!==e.style&&i(l)||0;"esriSLSNull"===e.style&&(u=0);const d=t(e.width),y=e.miterLimit;if(!r)return new j(e.materialKey,r,d,a,f,y,u,0,0,!1,n,!0,!1,s,d,0,null,p,L);const{rect:S,width:_,height:g}=r,w=S.x+o,P=S.y+o,K=w+_,x=P+g,T=m(w,P),b=m(K,x);return new j(e.materialKey,r,d,a,f,y,u,T,b,!0,n,!0,!1,s,d,0,null,p,L)}static fromPictureLineSymbol(e,t,i,r){return _.error("PictureLineSymbol support does not exist!"),null}}export{j as default};
