/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import e from"../../../core/has.js";import{releaseMaybe as t,disposeMaybe as r,isNone as i}from"../../../core/maybe.js";import"../../webgl/BufferObject.js";import s from"../../webgl/FramebufferObject.js";import"../../webgl/checkWebGLError.js";import"../../webgl/enums.js";import"../../../chunks/builtins.js";import o from"../../webgl/Texture.js";import"../../webgl/VertexArrayObject.js";import{NoiseTextureAtlasTechnique as a}from"./NoiseTextureAtlasTechnique.js";import{createQuadVAO as h}from"../webgl-engine/lib/glUtil3D.js";const f=e("esri-mobile")?64:128,u=Math.ceil(Math.sqrt(f)),m=(f+2)*u;class l{constructor(e,t){this._shapeTextureDescriptor={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,hasMipmap:!1,width:1,height:1},this._frameBuffer=new s(e,{colorTarget:0}),this._vao=h(e),this.textureAtlas=new o(e,this._shapeTextureDescriptor,null),this._technique=new a({rctx:e,viewingMode:t.state.viewingMode},null)}destroy(){this._technique=t(this._technique),this._frameBuffer=r(this._frameBuffer),this._vao=r(this._vao),this.textureAtlas=r(this.textureAtlas)}render(e){if(i(this._vao)||i(this.textureAtlas))return!1;this._frameBuffer.resize(m,m),this.textureAtlas.resize(m,m),this._frameBuffer.attachColorTexture(this.textureAtlas),e.bindFramebuffer(this._frameBuffer);const t=this._technique.program;e.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),this._technique.bindPipelineState(e),e.useProgram(t),t.setUniform1f("tileSize",f),t.setUniform1f("tileRows",u);const r=e.getViewport();return e.setViewport(0,0,m,m),e.gl.drawArrays(e.gl.TRIANGLE_STRIP,0,4),this._frameBuffer.detachColorTexture(),e.setViewport(r.x,r.y,r.width,r.height),!0}}export{m as ATLAS_SIZE,l as NoiseTextureAtlas,u as TILE_ROWS,f as TILE_SIZE};
