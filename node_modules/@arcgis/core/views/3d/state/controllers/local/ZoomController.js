/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../chunks/tslib.es6.js";import{clamp as i}from"../../../../../core/mathUtils.js";import{createScreenPointArray as s}from"../../../../../core/screenUtils.js";import{property as r}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/arrayUtils.js";import"../../../../../core/has.js";import"../../../../../core/accessorSupport/ensureType.js";import{subclass as e}from"../../../../../core/accessorSupport/decorators/subclass.js";import{c as a}from"../../../../../chunks/vec2.js";import{a as o}from"../../../../../chunks/vec2f64.js";import{f as n,n as h,a as m,b as c,o as p,g as l,l as u,e as P}from"../../../../../chunks/vec3.js";import{c as C}from"../../../../../chunks/vec3f64.js";import{create as v,fromPositionAndNormal as y}from"../../../../../geometry/support/plane.js";import{pixelDistanceToInteractionFactor as D,applyAll as f}from"../../../camera/constraintUtils.js";import{InteractiveController as d}from"../InteractiveController.js";import{normalizeCoordinate as g,DISTANCE_CLAMP_VALUES as j,PIVOT_DISTANCE_MODIFIER as w,SCREEN_PIXEL_AREA as N,intersectPlaneFromScreenPoint as O}from"../../utils/navigationUtils.js";let b=class extends d{constructor(t){super(t),this.view=null,this.tmpP=C(),this.tmpDir=C(),this.tmpN=C(),this.tmpP0=o(),this.tmpPoi=C(),this.tmpRayDir=C(),this.dragBeginPoint=s(),this.normalizedAnchorPoint=o(),this.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:C(),tiltMode:0},this.plane=v()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;let s;a(this.dragBeginPoint,t),g(this.startCamera,t,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(t,this.tmpP),n(this.tmpDir,this.tmpP,this.startCamera.eye),h(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(s=Math.abs(this.view.camera.position.z));let r=i(w*s,j[0],j[1]);const e=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),t[0],t[1],this.view.state.camera,N);r=r>e?e:r,m(this.tmpDir,this.tmpDir,r),c(this.tmpP,this.startCamera.eye,this.tmpDir),n(this.tmpN,this.startCamera.eye,this.startCamera.center),h(this.tmpN,this.tmpN),this.tmpN[1]<0&&p(this.tmpN,this.tmpN),y(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(t){if(!this.active)return;O(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||l(this.tmpPoi,this.currentCamera.center),g(this.currentCamera,t,this.tmpP0);let i=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);a(this.normalizedAnchorPoint,this.tmpP0),n(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const s=u(this.tmpRayDir);let r=s*(1-i);l(this.constraintOptions.interactionDirection,this.tmpRayDir),m(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(i)/s);const e=this.view.state.constraints.minimumPoiDistance;i>=0&&r<e&&(r=e,i=-(r-s)/s),Math.abs(s-r)<1e-6||(m(this.tmpRayDir,this.tmpRayDir,i),this.currentCamera.eye=c(M,this.currentCamera.eye,this.tmpRayDir),P(M,this.currentCamera.center,this.tmpPoi,i),this.tmpPoi[2]>this.startCamera.center[2]?M[2]=Math.max(this.startCamera.center[2],M[2]):M[2]=Math.min(this.startCamera.center[2],M[2]),this.currentCamera.center=M,this.constraintOptions.interactionFactor=D(this.dragBeginPoint,t),f(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};t([r({constructOnly:!0})],b.prototype,"view",void 0),b=t([e("esri.views.3d.state.controllers.local.ZoomController")],b);const M=C();export{b as ZoomController};
