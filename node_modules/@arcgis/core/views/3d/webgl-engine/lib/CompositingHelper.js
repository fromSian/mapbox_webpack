/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{disposeMaybe as r,isNone as t}from"../../../../core/maybe.js";import{createQuadVAO as e}from"./glUtil3D.js";import{CompositingTechniqueConfiguration as o,CompositingTechnique as i}from"../shaders/CompositingTechnique.js";import{vertexCount as s}from"../../../webgl/Util.js";class a{constructor(r,t){this._rctx=r,this._techniqueRepository=t}dispose(){this._vao=r(this._vao)}compositeTransparent(r,t,e,o=1){const a=this._rctx;n.alphaMode=1,n.function=2,n.hasOpacityFactor=1!==o;const c=this._techniqueRepository.acquire(i,n);a.useProgram(c.program),c.bindPipelineState(a),c.program.bindTexture(r,"colorTexture"),c.program.bindTexture(t,"alphaTexture"),c.program.bindTexture(e,"frontFaceTexture");const p=this.ensureVAO();a.bindVAO(p),a.drawArrays(5,0,s(p,"geometry")),c.release()}composite(r,t=0,e=1,o=0,a=0){const c=this._rctx;n.alphaMode=t,n.function=o,n.hasOpacityFactor=1!==e;const p=this._techniqueRepository.acquire(i,n);c.useProgram(p.program),p.bindPipelineState(c),p.program.bindTexture(r,"tex"),n.hasOpacityFactor&&p.program.setUniform1f("opacity",e),3===o&&p.program.setUniform1i("overlayIdx",a);const m=this.ensureVAO();c.bindVAO(m),c.drawArrays(5,0,s(m,"geometry")),p.release()}ensureVAO(){return t(this._vao)&&(this._vao=e(this._rctx)),this._vao}}const n=new o;export{a as default};
