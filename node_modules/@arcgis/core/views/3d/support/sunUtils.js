/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{lerp as t,clamp as i}from"../../../core/mathUtils.js";import{i as e,d as n,j as o,r as a}from"../../../chunks/mat4.js";import{c as r}from"../../../chunks/mat4f64.js";import{s as l,e as c,m as s}from"../../../chunks/vec3.js";import{c as u,f as m,a as d}from"../../../chunks/vec3f64.js";import{S as b}from"../../../chunks/SunCalc.js";const g={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function h(e,n,o,a,r){const s=n[2];l(a.ambient.color,1,1,1),a.ambient.intensity=g.global.ambient,l(a.direct.color,1,1,1),a.direct.intensity=g.global.direct;const u=i((Math.abs(s)-g.local.altitude)/(g.global.altitude-g.local.altitude),0,1);a.globalFactor=u;const m=b.getTimes(e,n[1],n[0]);if(u<1){const i=I(e,m,r);c(a.ambient.color,i.ambient.color,a.ambient.color,u),a.ambient.intensity=t(i.ambient.intensity,a.ambient.intensity,u),c(a.direct.color,i.direct.color,a.direct.color,u),a.direct.intensity=t(i.direct.intensity,a.direct.intensity,u)}a.noonFactor=P(e,m),f(e,n,o,a.direct.directionToLightSource)}function f(t,r,c,u){const m=O,d=e(T);if(1===c)b.getPosition(t,0,0,m),l(u,0,0,-1),n(d,d,-m.azimuth),o(d,d,-m.altitude),s(u,u,d);else{const e=g.planarDirection,o=e.globalAngles,c=r[2];let h=(Math.abs(c)-e.localAltitude)/(e.globalAltitude-e.localAltitude);h=i(h,0,1),h<1?(b.getPosition(t,r[1],r[0],m),m.azimuth=(1-h)*m.azimuth+h*o.azimuth,m.altitude=(1-h)*m.altitude+h*o.altitude):(m.azimuth=o.azimuth,m.altitude=o.altitude),l(u,0,-1,0),a(d,d,-m.azimuth),n(d,d,-m.altitude),s(u,u,d)}}function A(t,i){if(1===i)return!0;const e=g.planarDirection;return Math.abs(t)<e.localAltitude}function y(t,i,e,n,o){const a=t.getTime(),r=i.getTime()-a,l=Math.floor(r/e)+1,c=new Array(l);for(let s=0;s<l;++s)z.setTime(a+e*s),c[s]=u(),f(z,n,o,c[s]);return c}const p=m(.5773502691896258,-.5773502691896258,.5773502691896258);class N{constructor(){this.ambient={color:m(1,1,1),intensity:.55},this.direct={color:m(1,1,1),intensity:.55,directionToLightSource:d(p)},this.noonFactor=.5,this.globalFactor=0}}const T=r(),O={azimuth:0,altitude:0};function P(t,e){const n=t.valueOf();let o,a;e.polarException===b.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):e.polarException===b.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,a=n-1):(o=e.sunrise.valueOf(),a=e.sunset.valueOf());const r=o+(a-o)/2;return 1-i(Math.abs(n-r)/432e5,0,1)}function E(t){switch(t){case"disabled":case"sunny":return{direct:1,ambient:1};case"cloudy":return{direct:.8,ambient:1.1};case"rainy":return{direct:.4,ambient:1};case"foggy":return{direct:.3,ambient:1.6}}}function I(t,i,e){const n=t.valueOf();let o,a;i.polarException===b.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):i.polarException===b.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,a=n-1):(o=i.sunrise.valueOf(),a=i.sunset.valueOf());const r=a-o,l=o+r/2,c=r/4,s=l-c,u=l+c,d=.06*r,h=o-d/2,f=o+d/2,A=a-d/2,y=a+d/2,p=g.local,N=[.01,p.ambientAtNight],T=[.8,.8,1],O=[.01,.01,.01],P=[p.directAtTwilight,p.ambientAtTwilight],I=[1,.6,.5],z=[.8,.8,1],v=[.9*p.directAtNoon,p.ambientAtNoon],L=[1,.98,.98],_=[.98,.98,1],j=[p.directAtNoon,p.ambientAtNoon],w=[1,1,1],D=[1,1,1],H=v,R=L,S=_,k=P,x=I,C=z;let F,G,X=[0,0],U=[0,0,0],q=[0,0,0];n<h||n>y?(X=N,U=O,q=T,G="night"):n<f?(F=f-h,X=M(n-h,F,N,P),U=M(n-h,F,O,I),q=M(n-h,F,T,z),G="sun rising"):n<s?(F=s-f,X=M(n-f,F,P,v),U=M(n-f,F,I,L),q=M(n-f,F,z,_),G="early morning"):n<l?(F=l-s,X=M(n-s,F,v,j),U=M(n-s,F,L,w),q=M(n-s,F,_,D),G="late morning"):n<u?(F=u-l,X=M(n-l,F,j,H),U=M(n-l,F,w,R),q=M(n-l,F,D,S),G="early afternoon"):n<A?(F=A-u,X=M(n-u,F,H,k),U=M(n-u,F,R,x),q=M(n-u,F,S,C),G="late afternoon"):n<y&&(F=y-A,X=M(n-A,F,k,N),U=M(n-A,F,x,O),q=M(n-A,F,C,T),G="sun setting");const B=m(U[0],U[1],U[2]),J=m(q[0],q[1],q[2]),K=E(e);return{direct:{intensity:X[0]*K.direct,color:B},ambient:{intensity:X[1]*K.ambient,color:J},timeOfDay:G}}function M(t,i,e,n){const o=[];for(let a=0;a<e.length;a++)o[a]=(n[a]-e[a])*t/i+e[a];return o}const z=new Date(0);export{N as ColorAndIntensity,h as computeColorAndIntensity,y as computeDirectionsOverTime,A as computeShadowsEnabled};
