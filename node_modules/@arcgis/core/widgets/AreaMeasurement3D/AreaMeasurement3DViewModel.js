/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import t from"../../analysis/AreaMeasurement.js";import s from"../../core/Logger.js";import{isNone as i,isSome as r}from"../../core/maybe.js";import{measurementAreaUnits as n}from"../../core/unitUtils.js";import{property as o}from"../../core/accessorSupport/decorators/property.js";import"../../core/arrayUtils.js";import"../../core/has.js";import"../../core/accessorSupport/ensureType.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import{defaultUnitPropertyMetadata as l}from"../../properties/defaultUnit.js";import u from"../../views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DTool.js";import{InteractiveToolViewModel as p}from"../support/InteractiveToolViewModel.js";const d=s.getLogger("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel");let m=class extends p{constructor(e){super(e),this.logger=d,this.supportedViewType="3d",this.unsupportedErrorMessage="AreaMeasurement3DViewModel is only supported in 3D views.",this._userUnitOptions=null,this._userUnit=null,this.ready=!1,this.analysis=new t}initialize(){this.analysis.unit=this.unit}get state(){return this.disabled?"disabled":i(this.tool)?"ready":this.tool.state}get measurement(){if(i(this.tool)||this.disabled||this.tool.destroyed||"pending"===this.tool.toolState)return null;const e=this.tool.measurementView;if("pending"===e.state||"destroyed"===e.state)return null;const t=e.analysisVisualization,s=t.viewData,r=s.measurementData,n=s.validMeasurement,o="euclidean"===s.mode,a=0===(o?r.intersectingSegments:r.geodesicIntersectingSegments).size,l=a?n?"available":"unavailable":"invalid";return{mode:o?"euclidean":"geodesic",area:{text:a&&n?t.areaLabel:null,state:l},perimeterLength:{text:a&&n?t.perimeterLengthLabel:null,state:l}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.analysis.unit=this._userUnit}get unit(){return r(this._userUnit)?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}start(){return this.createTool()}clear(){this.removeTool()}createToolParams(){return{toolConstructor:u}}_findSelectableUnit(e,t){const s=this.unitOptions;return-1!==s.indexOf(e)?e:r(t)?this._findSelectableUnit(t):s[0]}_filteredOrAllUnits(e){if(i(e))return n.slice();const t=e.filter((e=>-1!==n.indexOf(e)));return 0===t.length?n.slice():t}async onConnectToAnalysisView(){r(this.view)&&this.view.ready&&(this.ready=!0)}onDisconnectFromAnalysisView(){this.ready=!1}};e([o()],m.prototype,"_userUnit",void 0),e([o()],m.prototype,"ready",void 0),e([o({readOnly:!0})],m.prototype,"state",null),e([o({readOnly:!0})],m.prototype,"measurement",null),e([o(l)],m.prototype,"defaultUnit",void 0),e([o()],m.prototype,"unitOptions",null),e([o()],m.prototype,"unit",null),e([o()],m.prototype,"analysis",void 0),m=e([a("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],m);const c=m;export{c as default};
