/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import"../../has.js";import{getOwnClassMetadata as e}from"../metadata.js";import{trackAccess as t}from"../tracking.js";import{processPrototypePropertyMetadata as r}from"../extensions/serializableProperty.js";const o=new Set,s=new Set;function i(t){return r=>{r.prototype.declaredClass=t,a(r);const i=[],n=[];let c=r.prototype;for(;c;)c.hasOwnProperty("initialize")&&!o.has(c.initialize)&&(o.add(c.initialize),i.push(c.initialize)),c.hasOwnProperty("destroy")&&!s.has(c.destroy)&&(s.add(c.destroy),n.push(c.destroy)),c=Object.getPrototypeOf(c);o.clear(),s.clear();class l extends r{constructor(...e){if(super(...e),this.constructor===l&&"function"==typeof this.postscript){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let e=i.length-1;e>=0;e--)i[e].call(this)}}),n.length){let e=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!e){e=!0;for(let e=0;e<n.length;e++)n[e].call(this)}}})}this.postscript(...e)}}}return l.__accessorMetadata__=e(r.prototype),l.prototype.declaredClass=t,l}}function n(e,r){return null==r.get?function(){const r=this.__accessor__.properties.get(e);if(void 0===r)return;t(r);const o=this.__accessor__.store;return o.has(e)?o.get(e):r.metadata.value}:function(){const t=this.__accessor__.properties.get(e);if(void 0!==t)return t.getComputed()}}function a(t){const o=t.prototype,s=e(o).properties,i={};for(const e of Object.getOwnPropertyNames(s)){const t=s[e];r(t),i[e]={enumerable:!0,configurable:!0,get:n(e,t),set(r){const o=this.__accessor__;if(void 0!==o){if(!Object.isFrozen(this)){if(o.initialized&&t.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${e}' of ${this.declaredClass}`);if(2===o.lifecycle&&t.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${e}' of ${this.declaredClass}`);o.set(e,r)}}else Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:r})}}}Object.defineProperties(t.prototype,i)}export{a as finalizeClass,i as subclass};
