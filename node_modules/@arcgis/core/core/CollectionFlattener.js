/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import o from"./Collection.js";import{HandleOwnerMixin as s}from"./HandleOwner.js";import{isSome as e,isNone as r}from"./maybe.js";import"./accessorSupport/watch.js";import{autorun as i}from"./accessorSupport/trackingUtils.js";import{property as n}from"./accessorSupport/decorators/property.js";import"./arrayUtils.js";import"./has.js";import"./accessorSupport/ensureType.js";import{subclass as c}from"./accessorSupport/decorators/subclass.js";let l=class extends(s(o)){constructor(t){super(t),this.getCollections=null}initialize(){this.handles.add(i((()=>this.refresh())))}destroy(){this.getCollections=null}refresh(){const t=e(this.getCollections)?this.getCollections():null;if(r(t))return void this.removeAll();let o=0;for(const s of t)e(s)&&(o=this._processCollection(o,s));this.splice(o,this.length)}_createNewInstance(t){return new o(t)}_processCollection(t,o){if(!o)return t;const s=this.itemFilterFunction?this.itemFilterFunction:t=>!!t;for(const e of o)if(e){if(s(e)){const o=this.indexOf(e,t);o>=0?o!==t&&this.reorder(e,t):this.add(e,t),++t}if(this.getChildrenFunction){const o=this.getChildrenFunction(e);if(Array.isArray(o))for(const s of o)t=this._processCollection(t,s);else t=this._processCollection(t,o)}}return t}};t([n()],l.prototype,"getCollections",void 0),t([n()],l.prototype,"getChildrenFunction",void 0),t([n()],l.prototype,"itemFilterFunction",void 0),l=t([c("esri.core.CollectionFlattener")],l);const p=l;export{p as default};
