/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import s from"./Accessor.js";import e from"./Logger.js";import{runTracked as r}from"./accessorSupport/tracking.js";import{property as a}from"./accessorSupport/decorators/property.js";import{subclass as n}from"./accessorSupport/decorators/subclass.js";import{SimpleTrackingTarget as c}from"./accessorSupport/tracking/SimpleTrackingTarget.js";const o=s=>{let r=class extends s{constructor(){super(...arguments),this._numUpdating=0,this.asyncUpdateState=new Map}get updating(){return this._numUpdating>0}autoUpdateAsync(t,s){return p((s=>this.updateAsync(t,s)),s)}async updateAsync(t,s){if(!this.startAsyncUpdate(t)){try{const e=await s();this._set(t,e)}catch(r){e.getLogger(this.declaredClass).warn(`Async update of "${t}" failed. Async update functions should not throw exceptions.`)}this.endAsyncUpdate(t)&&this.updateAsync(t,s)}}startAsyncUpdate(t){var s;const e=null!=(s=this.asyncUpdateState.get(t))?s:0;return 1&e?(this.asyncUpdateState.set(t,2|e),!0):(++this._numUpdating,this.asyncUpdateState.set(t,1|e),!1)}endAsyncUpdate(t){var s;--this._numUpdating;const e=-2&(null!=(s=this.asyncUpdateState.get(t))?s:0);return 2&e?(this.asyncUpdateState.set(t,-3&e),!0):(this.asyncUpdateState.set(t,e),!1)}};return t([a({readOnly:!0})],r.prototype,"updating",null),t([a()],r.prototype,"_numUpdating",void 0),r=t([n("esri.core.AsyncUpdate")],r),r};function p(t,s){const e=()=>{o&&!p&&t(a)},a=()=>{if(!o||p)return s();o.clear(),p=!0;const t=r(o,s);return p=!1,t},n=()=>{o&&(o.destroy(),o=null)};let o=new c(e),p=!1;return t(a),{remove:n}}let i=class extends(o(s)){};i=t([n("esri.core.AsyncUpdate")],i);export{i as AsyncUpdate,o as AsyncUpdateMixin};
